<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ë–ê–ó–ê –î–ê–ù–ù–´–• –°–ù–° </title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #0d1117; color: #c9d1d9; padding: 20px; }
        .box { max-width: 900px; margin: auto; background: #161b22; border: 1px solid #30363d; padding: 25px; border-radius: 12px; }
        h2 { text-align: center; color: #58a6ff; text-transform: uppercase; letter-spacing: 1px; }
        input, textarea, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 6px; border: 1px solid #30363d; background: #0d1117; color: white; box-sizing: border-box; }
        button { cursor: pointer; font-weight: bold; background: #238636; border: none; transition: 0.2s; }
        button:hover { background: #2ea043; }
        .search-bar { border: 2px solid #58a6ff; font-size: 1.1em; margin-bottom: 20px; }
        .hidden { display: none; }
        .player-card { border: 1px solid #30363d; padding: 15px; margin-top: 10px; display: flex; align-items: center; background: #21262d; border-radius: 8px; }
        .player-card img { width: 80px; height: 80px; border-radius: 6px; object-fit: cover; margin-right: 20px; border: 2px solid #30363d; }
        .card-info { flex-grow: 1; }
        .edit-controls { display: flex; align-items: center; gap: 10px; margin-top: 5px; }
        .mini-btn { width: 35px; height: 35px; padding: 0; line-height: 35px; background: #30363d; border: 1px solid #58a6ff; }
        .save-fast { background: #8957e5; width: auto; padding: 5px 15px; font-size: 12px; margin-left: 10px; }
        .status-tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 12px; background: #388e3c; color: white; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="box">
    <h2 id="main-title">–ö–û–î –î–û–°–¢–£–ü–ê</h2>
    
    <div id="login">
        <input type="password" id="p_code" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞ (–ü—Ä–æ—Å–º–æ—Ç—Ä / –°—É–¥—å—è / –ê–¥–º–∏–Ω)...">
        <button onclick="login()">–ê–í–¢–û–†–ò–ó–û–í–ê–¢–¨–°–Ø</button>
    </div>

    <div id="app-content" class="hidden">
        <div id="status-display" class="status-tag">–†–µ–∂–∏–º: –ü—Ä–æ—Å–º–æ—Ç—Ä</div>
        <input type="text" class="search-bar" id="search" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ ID –∏–≥—Ä–æ–∫–∞..." oninput="renderList()">
        
        <div id="full-admin-form" class="hidden">
            <h3 id="form-title">–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø / –ü–û–õ–ù–ê–Ø –ü–†–ê–í–ö–ê</h3>
            <input type="hidden" id="edit-id">
            <input type="text" id="n" placeholder="–ù–∏–∫–Ω–µ–π–º">
            <input type="text" id="id_code" placeholder="ID (–Ω–∞–ø—Ä–∏–º–µ—Ä: 777)">
            <input type="file" id="file-input" accept="image/*">
            <input type="hidden" id="photo-data">
            <input type="text" id="t" placeholder="–°—Ä–æ–∫ –∑–∞–∫–ª—é—á–µ–Ω–∏—è">
            <button onclick="saveFull()">–°–û–•–†–ê–ù–ò–¢–¨ –ù–û–í–û–ì–û / –û–ë–ù–û–í–ò–¢–¨ –í–°–Å</button>
            <hr>
        </div>

        <div id="player-list"></div>
        <button onclick="location.reload()" style="background: #da3633; margin-top: 20px;">–í–´–ô–¢–ò –ò–ó –°–ò–°–¢–ï–ú–´</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "–¢–í–û–ô_API_KEY", 
        databaseURL: "https://dfdf-ba19f-default-rtdb.firebaseio.com/",
        projectId: "dfdf-ba19f",
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let currentMode = ''; // 'view', 'judge', 'admin'

    // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ñ–æ—Ç–æ
    document.getElementById('file-input').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onloadend = () => document.getElementById('photo-data').value = reader.result;
        if (file) reader.readAsDataURL(file);
    });

    function login() {
        const c = document.getElementById('p_code').value;
        const status = document.getElementById('status-display');
        
        if (c === '5389') { currentMode = 'view'; status.innerText = "–†–ï–ñ–ò–ú: –ü–†–û–°–ú–û–¢–†"; }
        else if (c === '3956') { currentMode = 'judge'; status.innerText = "–†–ï–ñ–ò–ú: –°–£–î–¨–Ø (–ü–†–ê–í–ö–ê –î–ï–õ)"; status.style.background = "#8957e5"; }
        else if (c === '4583') { currentMode = 'admin'; status.innerText = "–†–ï–ñ–ò–ú: –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†"; status.style.background = "#da3633"; document.getElementById('full-admin-form').classList.remove('hidden'); }
        else { alert("–ù–ï–í–ï–†–ù–´–ô –ö–û–î"); return; }

        document.getElementById('login').classList.add('hidden');
        document.getElementById('app-content').classList.remove('hidden');
        renderList();
    }

    function renderList() {
        const search = document.getElementById('search').value.toLowerCase();
        db.ref('players').on('value', (snap) => {
            const data = snap.val();
            const container = document.getElementById('player-list');
            container.innerHTML = '';

            for (let id in data) {
                const p = data[id];
                if (p.id_code.toLowerCase().includes(search)) {
                    let html = `
                        <div class="player-card">
                            <img src="${p.img || 'https://via.placeholder.com/80'}">
                            <div class="card-info">
                                <b>${p.n}</b> [ID: ${p.id_code}]<br>
                                <small>–°—Ä–æ–∫: ${p.t || '–ù–µ—Ç'}</small> | 
                                <span>–°—É–¥–∏–º–æ—Å—Ç–µ–π: <b>${p.s || 0}</b></span> | 
                                <span>–ö–∞–∑–Ω–µ–π: <b>${p.k || 0}</b></span>
                                <div style="color: #ffa657; font-size: 13px;">–ü—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è: ${p.v || '–ß–∏—Å—Ç'}</div>
                    `;

                    // –ï—Å–ª–∏ –∑–∞—à–µ–ª –°—É–¥—å—è (3956) –∏–ª–∏ –ê–¥–º–∏–Ω (4583)
                    if (currentMode === 'judge' || currentMode === 'admin') {
                        html += `
                            <div class="edit-controls">
                                –°—É–¥–∏–º–æ—Å—Ç–∏: 
                                <button class="mini-btn" onclick="updateVal('${id}', 's', -1)">-</button>
                                <button class="mini-btn" onclick="updateVal('${id}', 's', 1)">+</button>
                                | –ö–∞–∑–Ω–∏: 
                                <button class="mini-btn" onclick="updateVal('${id}', 'k', -1)">-</button>
                                <button class="mini-btn" onclick="updateVal('${id}', 'k', 1)">+</button>
                                <button class="save-fast" onclick="editCrimes('${id}', '${p.v || ''}')">–ò–ó–ú–ï–ù–ò–¢–¨ –ü–†–ò–°–¢–£–ü–õ–ï–ù–ò–Ø</button>
                            </div>
                        `;
                    }
                    
                    // –ï—Å–ª–∏ –∑–∞—à–µ–ª –ê–¥–º–∏–Ω (4583)
                    if (currentMode === 'admin') {
                        html += `
                            <div style="margin-top:10px;">
                                <button class="save-fast" style="background:#444" onclick="fillForm('${id}')">–ü–û–õ–ù–ê–Ø –ü–†–ê–í–ö–ê</button>
                                <button class="save-fast" style="background:#da3633" onclick="deleteP('${id}')">–£–î–ê–õ–ò–¢–¨</button>
                            </div>
                        `;
                    }

                    html += `</div></div>`;
                    container.innerHTML += html;
                }
            }
        });
    }

    // –ë—ã—Å—Ç—Ä–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —á–∏—Å–µ–ª (+/-)
    function updateVal(id, field, delta) {
        const ref = db.ref('players/' + id + '/' + field);
        ref.transaction((current) => (current || 0) + delta);
    }

    // –ë—ã—Å—Ç—Ä–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π
    function editCrimes(id, oldText) {
        const newText = prompt("–í–≤–µ–¥–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π:", oldText);
        if (newText !== null) db.ref('players/' + id + '/v').set(newText);
    }

    // –£–¥–∞–ª–µ–Ω–∏–µ
    function deleteP(id) { if(confirm("–£–¥–∞–ª–∏—Ç—å?")) db.ref('players/'+id).remove(); }

    // –ü–æ–ª–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–¥–ª—è –∞–¥–º–∏–Ω–∞)
    function saveFull() {
        const key = document.getElementById('edit-id').value;
        const data = {
            n: document.getElementById('n').value,
            id_code: document.getElementById('id_code').value,
            img: document.getElementById('photo-data').value || 'https://via.placeholder.com/80',
            t: document.getElementById('t').value,
            s: 0, k: 0, v: "–ù–æ–≤–æ–µ –¥–µ–ª–æ" // –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –Ω–æ–≤–æ–≥–æ
        };
        if(key) {
             // –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∞–¥–º–∏–Ω–æ–º –Ω–µ –∑–∞—Ç–∏—Ä–∞–µ–º —Å—É–¥–∏–º–æ—Å—Ç–∏ –∏ –∫–∞–∑–Ω–∏
             db.ref('players/' + key).update({ n: data.n, id_code: data.id_code, img: data.img, t: data.t });
        } else {
             db.ref('players').push(data);
        }
        alert("–ì–æ—Ç–æ–≤–æ!"); location.reload();
    }

    function fillForm(id) {
        db.ref('players/' + id).once('value').then(s => {
            const p = s.val();
            document.getElementById('edit-id').value = id;
            document.getElementById('n').value = p.n;
            document.getElementById('id_code').value = p.id_code;
            document.getElementById('t').value = p.t;
            document.getElementById('photo-data').value = p.img;
            document.getElementById('form-title').innerText = "–†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï: " + p.n;
        });
    }
</script>
</body>
</html>
