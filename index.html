<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ë–ê–ó–ê –î–ê–ù–ù–´–• –°–ù–° </title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #0d1117; color: #c9d1d9; padding: 20px; margin: 0; }
        .box { max-width: 800px; margin: 40px auto; background: #161b22; border: 1px solid #30363d; padding: 25px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h2 { text-align: center; color: #58a6ff; text-transform: uppercase; margin-bottom: 20px; }
        input, textarea, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 6px; border: 1px solid #30363d; background: #0d1117; color: white; box-sizing: border-box; }
        button { cursor: pointer; font-weight: bold; background: #238636; border: none; transition: 0.2s; }
        button:hover { background: #2ea043; }
        
        .search-container { position: sticky; top: 0; background: #161b22; padding: 10px 0; z-index: 10; border-bottom: 1px solid #30363d; margin-bottom: 15px; }
        .search-bar { border: 2px solid #58a6ff; font-size: 1.1em; }
        
        .hidden { display: none; }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –∏–≥—Ä–æ–∫–∞ */
        .player-card { border: 1px solid #30363d; padding: 20px; margin-top: 15px; display: flex; gap: 20px; background: #21262d; border-radius: 8px; align-items: flex-start; }
        .player-card img { width: 100px; height: 100px; border-radius: 6px; object-fit: cover; border: 2px solid #30363d; background: #0d1117; }
        .card-info { flex: 1; }
        .card-info b { color: #58a6ff; font-size: 1.2em; }
        
        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .controls { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; padding-top: 12px; border-top: 1px dashed #30363d; }
        .mini-btn { width: 40px; height: 35px; background: #30363d; color: #58a6ff; border: 1px solid #58a6ff; }
        .btn-blue { background: #8957e5; width: auto; padding: 5px 15px; font-size: 13px; }
        .btn-red { background: #da3633; width: auto; padding: 5px 15px; font-size: 13px; }
        
        .mode-tag { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; margin-bottom: 15px; background: #30363d; }
    </style>
</head>
<body>

<div class="box">
    <h2>–ö–û–î –î–û–°–¢–£–ü–ê</h2>
    
    <div id="login-screen">
        <input type="password" id="p_code" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞...">
        <button onclick="auth()">–ê–í–¢–û–†–ò–ó–û–í–ê–¢–¨–°–Ø</button>
    </div>

    <div id="main-ui" class="hidden">
        <div id="current-mode" class="mode-tag">–†–µ–∂–∏–º: –ü—Ä–æ—Å–º–æ—Ç—Ä</div>
        
        <div class="search-container">
            <input type="text" class="search-bar" id="search-input" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ ID –∏–≥—Ä–æ–∫–∞..." oninput="renderData()">
        </div>

        <div id="admin-form" class="hidden">
            <h3 style="color: #f85149">–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ù–û–í–û–ì–û –ó–ê–ö–õ–Æ–ß–ï–ù–ù–û–ì–û</h3>
            <input type="text" id="reg-name" placeholder="–ù–∏–∫–Ω–µ–π–º">
            <input type="text" id="reg-id" placeholder="ID (–Ω–∞–ø—Ä–∏–º–µ—Ä: 105)">
            <input type="text" id="reg-term" placeholder="–°—Ä–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 5 –ª–µ—Ç)">
            <label style="font-size: 12px; color: #8b949e;">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ:</label>
            <input type="file" id="file-picker" accept="image/*">
            <input type="hidden" id="img-base64">
            <button onclick="createNew()">–î–û–ë–ê–í–ò–¢–¨ –í –ë–ê–ó–£</button>
            <hr style="border-color: #30363d; margin: 20px 0;">
        </div>

        <div id="player-list"></div>

        <button onclick="location.reload()" style="background: #30363d; margin-top: 30px;">–í–´–ô–¢–ò –ò–ó –°–ò–°–¢–ï–ú–´</button>
    </div>
</div>

<script>
    // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
    const firebaseConfig = {
        apiKey: "–¢–í–û–ô_API_KEY", 
        databaseURL: "https://dfdf-ba19f-default-rtdb.firebaseio.com/",
        projectId: "dfdf-ba19f",
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    let userRole = 'view'; 

    // –õ–æ–≥–∏–∫–∞ —Ñ–æ—Ç–æ
    document.getElementById('file-picker').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = () => document.getElementById('img-base64').value = reader.result;
        if (e.target.files[0]) reader.readAsDataURL(e.target.files[0]);
    });

    function auth() {
        const code = document.getElementById('p_code').value;
        const tag = document.getElementById('current-mode');
        
        if (code === '5389') { userRole = 'view'; tag.innerText = "–†–ï–ñ–ò–ú: –ü–†–û–°–ú–û–¢–†"; }
        else if (code === '3956') { userRole = 'judge'; tag.innerText = "–†–ï–ñ–ò–ú: –°–£–î–¨–Ø"; tag.style.color = "#8957e5"; }
        else if (code === '4583') { 
            userRole = 'admin'; 
            tag.innerText = "–†–ï–ñ–ò–ú: –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†"; 
            tag.style.color = "#f85149";
            document.getElementById('admin-form').classList.remove('hidden'); 
        } else { alert("–î–û–°–¢–£–ü –ó–ê–ö–†–´–¢"); return; }

        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('main-ui').classList.remove('hidden');
        renderData();
    }

    function renderData() {
        const query = document.getElementById('search-input').value.toLowerCase();
        database.ref('players').on('value', (snap) => {
            const list = document.getElementById('player-list');
            list.innerHTML = '';
            const data = snap.val();

            for (let key in data) {
                const p = data[key];
                if (p.id_code.toLowerCase().includes(query)) {
                    let card = `
                        <div class="player-card">
                            <img src="${p.img || 'https://via.placeholder.com/100'}">
                            <div class="card-info">
                                <b>${p.n}</b> [ID: ${p.id_code}]<br>
                                <small>–°—Ä–æ–∫: ${p.t || '–ù–µ —É–∫–∞–∑–∞–Ω'}</small> | 
                                –°—É–¥–∏–º–æ—Å—Ç–∏: <b>${p.s || 0}</b> | –ö–∞–∑–Ω–∏: <b>${p.k || 0}</b>
                                <div style="color: #ffa657; font-size: 13px; margin-top: 5px;">–ù–∞—Ä—É—à–µ–Ω–∏—è: ${p.v || '–ù–µ—Ç'}</div>
                    `;

                    // –ö–Ω–æ–ø–∫–∏ –¥–ª—è –°—É–¥—å–∏ –∏ –ê–¥–º–∏–Ω–∞
                    if (userRole === 'judge' || userRole === 'admin') {
                        card += `
                            <div class="controls">
                                <button class="mini-btn" onclick="modify('${key}', 's', 1)">S+</button>
                                <button class="mini-btn" onclick="modify('${key}', 's', -1)">S-</button>
                                <button class="mini-btn" onclick="modify('${key}', 'k', 1)">K+</button>
                                <button class="mini-btn" onclick="modify('${key}', 'k', -1)">K-</button>
                                <button class="btn-blue" onclick="editV('${key}', '${p.v || ''}')">–ò–ó–ú–ï–ù–ò–¢–¨ –î–ï–õ–û</button>
                                ${userRole === 'admin' ? `<button class="btn-red" onclick="removeP('${key}')">–£–î–ê–õ–ò–¢–¨</button>` : ''}
                            </div>
                        `;
                    }

                    card += `</div></div>`;
                    list.innerHTML += card;
                }
            }
        });
    }

    function createNew() {
        const n = document.getElementById('reg-name').value;
        const id = document.getElementById('reg-id').value;
        if(!n || !id) return alert("–ó–∞–ø–æ–ª–Ω–∏ –Ω–∏–∫ –∏ ID!");
        
        database.ref('players').push({
            n: n, id_code: id, t: document.getElementById('reg-term').value,
            img: document.getElementById('img-base64').value,
            s: 0, k: 0, v: "–ù–æ–≤–æ–µ –¥–µ–ª–æ –æ—Ç–∫—Ä—ã—Ç–æ"
        });
        alert("–ò–≥—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω!");
    }

    function modify(key, field, val) {
        database.ref('players/' + key + '/' + field).transaction(c => (c || 0) + val);
    }

    function editV(key, old) {
        const text = prompt("–°–ø–∏—Å–æ–∫ –Ω–∞—Ä—É—à–µ–Ω–∏–π:", old);
        if (text !== null) database.ref('players/' + key + '/v').set(text);
    }

    function removeP(key) {
        if(confirm("–£–¥–∞–ª–∏—Ç—å –∏–≥—Ä–æ–∫–∞?")) database.ref('players/' + key).remove();
    }
</script>

</body>
</html>
