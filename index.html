<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ë–ê–ó–ê –î–ê–ù–ù–´–• –°–ù–° </title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #0d1117; color: #c9d1d9; padding: 20px; }
        .box { max-width: 850px; margin: auto; background: #161b22; border: 1px solid #30363d; padding: 25px; border-radius: 12px; }
        h2 { text-align: center; color: #58a6ff; text-transform: uppercase; }
        input, textarea, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 6px; border: 1px solid #30363d; background: #0d1117; color: white; box-sizing: border-box; }
        button { cursor: pointer; font-weight: bold; background: #238636; border: none; }
        button:hover { background: #2ea043; }
        .search-bar { border: 2px solid #58a6ff; margin-bottom: 20px; font-size: 1.1em; }
        .hidden { display: none; }
        .player-card { border: 1px solid #30363d; padding: 15px; margin-top: 10px; display: flex; align-items: center; background: #21262d; border-radius: 8px; position: relative; }
        .player-card img { width: 90px; height: 90px; border-radius: 6px; object-fit: cover; margin-right: 20px; border: 2px solid #30363d; }
        .card-info { flex-grow: 1; }
        .admin-btns { display: flex; flex-direction: column; gap: 5px; }
        .btn-edit { background: #8957e5; padding: 5px 10px; width: auto; font-size: 12px; }
        .btn-del { background: #da3633; padding: 5px 10px; width: auto; font-size: 12px; }
        .file-label { display: block; margin-top: 10px; color: #8b949e; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="box">
    <h2>–ö–û–î</h2>
    
    <div id="login">
        <input type="password" id="p_code" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞...">
        <button onclick="login()">–í–û–ô–¢–ò</button>
    </div>

    <div id="view" class="hidden">
        <input type="text" class="search-bar" id="search-view" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ ID..." oninput="load(false)">
        <div id="list-public"></div>
        <button onclick="location.reload()" style="background: #444; margin-top: 20px;">–í–´–•–û–î</button>
    </div>

    <div id="add" class="hidden">
        <h3 id="form-title">–£–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–ü–ò–°–¨–Æ</h3>
        <input type="hidden" id="edit-id">
        <input type="text" id="n" placeholder="–ù–∏–∫–Ω–µ–π–º">
        <input type="text" id="id_code" placeholder="–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–π ID (–Ω–∞–ø—Ä–∏–º–µ—Ä: 001)">
        
        <label class="file-label">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ –∏–≥—Ä–æ–∫–∞:</label>
        <input type="file" id="file-input" accept="image/*">
        <input type="hidden" id="photo-data"> <input type="number" id="s" placeholder="–°—É–¥–∏–º–æ—Å—Ç–∏">
        <input type="number" id="k" placeholder="–ö–∞–∑–Ω–∏">
        <input type="text" id="t" placeholder="–°—Ä–æ–∫">
        <textarea id="v" placeholder="–ù–∞—Ä—É—à–µ–Ω–∏—è"></textarea>
        
        <button id="save-btn" onclick="save()">–°–û–•–†–ê–ù–ò–¢–¨</button>
        <button onclick="resetForm()" style="background:#444">–û–ß–ò–°–¢–ò–¢–¨</button>
        
        <hr style="border: 1px solid #30363d; margin: 25px 0;">
        <input type="text" class="search-bar" id="search-admin" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ ID –¥–ª—è –ø—Ä–∞–≤–∫–∏..." oninput="load(true)">
        <div id="list-admin"></div>
        <button onclick="location.reload()" style="background: #da3633; margin-top: 20px;">–í–´–ô–¢–ò</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "–í–°–¢–ê–í–¨_–°–í–û–ô_API_KEY", 
        databaseURL: "https://dfdf-ba19f-default-rtdb.firebaseio.com/",
        projectId: "dfdf-ba19f",
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞ (–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ —Ç–µ–∫—Å—Ç)
    document.getElementById('file-input').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onloadend = function() {
            document.getElementById('photo-data').value = reader.result;
        }
        if (file) reader.readAsDataURL(file);
    });

    function login() {
        const c = document.getElementById('p_code').value;
        if (c === '5389') {
            document.getElementById('login').classList.add('hidden');
            document.getElementById('view').classList.remove('hidden');
            load(false);
        } else if (c === '4583') {
            document.getElementById('login').classList.add('hidden');
            document.getElementById('add').classList.remove('hidden');
            load(true);
        } else { alert("–û–¢–ö–ê–ó–ê–ù–û"); }
    }

    function save() {
        const key = document.getElementById('edit-id').value;
        const data = {
            n: document.getElementById('n').value,
            id_code: document.getElementById('id_code').value,
            img: document.getElementById('photo-data').value || 'https://via.placeholder.com/90',
            s: document.getElementById('s').value,
            k: document.getElementById('k').value,
            t: document.getElementById('t').value,
            v: document.getElementById('v').value
        };

        if (key) db.ref('players/' + key).set(data).then(() => { alert("–û–±–Ω–æ–≤–ª–µ–Ω–æ!"); resetForm(); });
        else db.ref('players').push(data).then(() => { alert("–î–æ–±–∞–≤–ª–µ–Ω–æ!"); resetForm(); });
    }

    function load(isAdmin) {
        const searchQuery = document.getElementById(isAdmin ? 'search-admin' : 'search-view').value.toLowerCase();
        db.ref('players').on('value', (snapshot) => {
            const data = snapshot.val();
            const container = document.getElementById(isAdmin ? 'list-admin' : 'list-public');
            container.innerHTML = '';

            for (let id in data) {
                const p = data[id];
                // –§–∏–ª—å—Ç—Ä –ø–æ ID
                if (p.id_code.toLowerCase().includes(searchQuery)) {
                    container.innerHTML += `
                        <div class="player-card">
                            <img src="${p.img}">
                            <div class="card-info">
                                <b>${p.n}</b> [ID: ${p.id_code}]<br>
                                <small>–°—Ä–æ–∫: ${p.t} | –°—É–¥–∏–º–æ—Å—Ç–∏: ${p.s} | –ö–∞–∑–Ω–∏: ${p.k}</small><br>
                                <span style="font-size: 12px; color: #8b949e;">${p.v}</span>
                            </div>
                            ${isAdmin ? `
                                <div class="admin-btns">
                                    <button class="btn-edit" onclick="editPlayer('${id}')">–ü–†–ê–í–ö–ê</button>
                                    <button class="btn-del" onclick="deletePlayer('${id}')">–£–î–ê–õ–ò–¢–¨</button>
                                </div>
                            ` : ''}
                        </div>`;
                }
            }
        });
    }

    function editPlayer(id) {
        db.ref('players/' + id).once('value').then((snap) => {
            const p = snap.val();
            document.getElementById('edit-id').value = id;
            document.getElementById('n').value = p.n;
            document.getElementById('id_code').value = p.id_code;
            document.getElementById('photo-data').value = p.img;
            document.getElementById('s').value = p.s;
            document.getElementById('k').value = p.k;
            document.getElementById('t').value = p.t;
            document.getElementById('v').value = p.v;
            document.getElementById('form-title').innerText = "–†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï";
            window.scrollTo(0,0);
        });
    }

    function deletePlayer(id) { if (confirm("–£–¥–∞–ª–∏—Ç—å?")) db.ref('players/' + id).remove(); }
    
    function resetForm() {
        document.getElementById('edit-id').value = '';
        document.getElementById('photo-data').value = '';
        document.getElementById('file-input').value = '';
        document.getElementById('n').value = '';
        document.getElementById('id_code').value = '';
        document.getElementById('s').value = '';
        document.getElementById('k').value = '';
        document.getElementById('t').value = '';
        document.getElementById('v').value = '';
        document.getElementById('form-title').innerText = "–£–ü–†–ê–í–õ–ï–ù–ò–ï –ó–ê–ü–ò–°–¨–Æ";
    }
</script>
</body>
</html>
