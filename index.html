<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Rust 2D: FIXED</title>
<style>
    body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; user-select: none; }
    canvas { display: block; position: absolute; top: 0; left: 0; z-index: 0; }

    /* UI Layers - –í–ê–ñ–ù–û: Z-INDEX –í–´–°–û–ö–ò–ô */
    #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; }
    .pointer { pointer-events: auto; }

    /* HUD */
    #hud { position: absolute; bottom: 20px; left: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 101; }
    .bar { width: 280px; height: 30px; background: rgba(0,0,0,0.8); border: 2px solid #444; border-radius: 6px; overflow: hidden; position: relative; box-shadow: 0 4px 10px black; }
    .fill { height: 100%; transition: width 0.2s; }
    .bar-text { position: absolute; right: 10px; top: 2px; font-size: 16px; color: white; font-weight: bold; text-shadow: 1px 1px 2px #000; }

    /* HOTBAR */
    #hotbar { 
        position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%); 
        display: flex; gap: 8px; padding: 10px; 
        background: rgba(20,20,20,0.8); border-radius: 12px; border: 1px solid #555; 
        z-index: 101; pointer-events: auto;
    }
    .slot { 
        width: 70px; height: 70px; 
        background: rgba(50,50,50,0.9); border: 2px solid #666; 
        color: white; display: flex; flex-direction: column; align-items: center; justify-content: center;
        cursor: pointer; position: relative; border-radius: 6px;
    }
    .slot:hover { background: #666; border-color: #fff; }
    .slot.active { border-color: #76ff03; box-shadow: 0 0 15px #76ff03; transform: translateY(-5px); }
    .slot-icon { font-size: 35px; filter: drop-shadow(0 2px 2px black); }
    .slot-count { position: absolute; bottom: 2px; right: 5px; font-weight: bold; font-size: 14px; text-shadow: 1px 1px 0 #000; }

    /* NOTIFICATIONS */
    #notify-area { 
        position: absolute; bottom: 140px; right: 20px; 
        display: flex; flex-direction: column; gap: 5px; align-items: flex-end; 
        z-index: 102;
    }
    .note { 
        background: rgba(10,10,10,0.9); color: #fff; padding: 12px 25px; 
        border-right: 5px solid #76ff03; font-size: 18px; font-weight: bold;
        animation: fadeOut 3s forwards; box-shadow: 0 5px 15px black;
    }
    @keyframes fadeOut { 0% {opacity:1; transform: translateX(0);} 80% {opacity:1;} 100% {opacity:0; transform: translateX(50px);} }

    /* MENUS (START & INV) */
    .menu-overlay { 
        position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
        background: rgba(0,0,0,0.9); /* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω –º–µ–Ω—é */
        display: flex; justify-content: center; align-items: center; 
        z-index: 9999; /* –ü–û–í–ï–†–• –í–°–ï–ì–û */
        pointer-events: auto;
    }
    .panel { 
        background: #282828; border: 2px solid #555; padding: 30px; color: #eee; border-radius: 10px; 
        box-shadow: 0 0 50px black; display: flex; gap: 30px; 
    }
    
    /* DRAG GHOST */
    #drag-ghost {
        position: fixed; width: 70px; height: 70px; pointer-events: none; z-index: 10000;
        display: none; opacity: 0.9; transform: translate(-50%, -50%);
    }
    #drag-ghost .slot { border-color: #76ff03; background: #333; box-shadow: 0 10px 30px black; }

    /* Inventory Grid */
    .inv-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; }
    
    /* Start Button */
    .btn {
        padding: 20px 50px; font-size: 24px; background: #76ff03; border: none; font-weight: bold; 
        cursor: pointer; border-radius: 5px; box-shadow: 0 0 20px #76ff03; color: black;
        transition: 0.2s;
    }
    .btn:hover { transform: scale(1.1); background: white; }
</style>
</head>
<body>

<canvas id="cvs"></canvas>
<div id="drag-ghost"></div>

<div id="start-screen" class="menu-overlay">
    <div style="text-align: center;">
        <h1 style="color: #76ff03; font-size: 100px; margin: 0; text-shadow: 0 5px 0 #005cb2;">RUST 2D</h1>
        <p style="color: #aaa; font-size: 20px; margin-bottom: 40px;">–ö–†–ê–§–¢ ‚Ä¢ –í–´–ñ–ò–í–ê–ù–ò–ï ‚Ä¢ –†–ï–ô–î–´</p>
        <button class="btn" onclick="initGame(true)">–ò–ì–†–ê–¢–¨</button>
        <p style="margin-top:20px; font-size:12px; color:#555">WASD - –ë–µ–≥ | E - –ò–Ω–≤–µ–Ω—Ç–∞—Ä | –õ–ö–ú - –î–æ–±—ã—á–∞/–ê—Ç–∞–∫–∞</p>
    </div>
</div>

<div id="ui-layer" style="display:none;">
    <div id="notify-area"></div>
    <div id="hud">
        <div class="bar"><div class="fill" id="hp-bar" style="background:#d32f2f; width:100%"></div><span class="bar-text">–ó–î–û–†–û–í–¨–ï</span></div>
        <div class="bar"><div class="fill" id="food-bar" style="background:#f57c00; width:100%"></div><span class="bar-text">–ì–û–õ–û–î</span></div>
    </div>
    <div id="hotbar"></div>
</div>

<div id="game-menu" class="menu-overlay" style="display:none;">
    <div class="panel">
        <div>
            <h3>–†–Æ–ö–ó–ê–ö</h3>
            <div class="inv-grid" id="inv-grid"></div>
        </div>
        <div style="border-left: 2px solid #444; padding-left: 30px;">
            <h3>–ö–†–ê–§–¢</h3>
            <div id="craft-list" style="height: 400px; overflow-y: auto; width: 300px;"></div>
        </div>
    </div>
</div>

<script>
// --- CONFIG & DATA ---
const cvs = document.getElementById('cvs');
const ctx = cvs.getContext('2d');
const W_MAP = 3000, H_MAP = 3000;
const X_WATER = 400;

const ITEMS = {
    rock: { name: '–ö–∞–º–µ–Ω—å', icon: 'ü™®', type: 'tool', dmg: 15, bonus: 'rock' },
    wood: { name: '–î–µ—Ä–µ–≤–æ', icon: 'üå≤', type: 'res' },
    stone: { name: '–†—É–¥–∞', icon: 'üåë', type: 'res' },
    iron_ore: { name: '–ñ–µ–ª–µ–∑–æ (–†—É–¥–∞)', icon: 'ü™®', type: 'res' },
    sulfur_ore: { name: '–°–µ—Ä–∞ (–†—É–¥–∞)', icon: 'üü°', type: 'res' },
    scrap: { name: '–°–∫—Ä–∞–ø', icon: '‚öôÔ∏è', type: 'comp' },
    cloth: { name: '–¢–∫–∞–Ω—å', icon: 'üß∂', type: 'comp' },
    fat: { name: '–ñ–∏—Ä', icon: 'ü•©', type: 'comp' },
    axe: { name: '–¢–æ–ø–æ—Ä', icon: 'ü™ì', type: 'tool', dmg: 30, bonus: 'tree' },
    pickaxe: { name: '–ö–∏—Ä–∫–∞', icon: '‚õèÔ∏è', type: 'tool', dmg: 30, bonus: 'rock' },
    bow: { name: '–õ—É–∫', icon: 'üèπ', type: 'weapon', dmg: 40 },
    ak: { name: 'AK-47', icon: 'üî´', type: 'weapon', dmg: 20 },
    food: { name: '–ï–¥–∞', icon: 'ü•´', type: 'food' }
};

const RECIPES = [
    { id: 'axe', cost: { wood: 100, stone: 50 } },
    { id: 'pickaxe', cost: { wood: 100, stone: 50 } },
    { id: 'bow', cost: { wood: 200, cloth: 50 } },
    { id: 'ak', cost: { scrap: 200, iron_ore: 50 } } // –£–ø—Ä–æ—â–µ–Ω–æ
];

// --- STATE ---
let player = { x: 800, y: 1500, hp: 100, food: 100, angle: 0, inv: Array(24).fill(null), belt: Array(6).fill(null), beltIdx: 0 };
let world = { entities: [], static: [], roads: [] };
let cam = { x:0, y:0 };
let input = { w:0, a:0, s:0, d:0, mx:0, my:0 };
let gameTime = 0;
let isMenuOpen = false;
let gameRunning = false;
let dragObj = { active: false, item: null, fromIdx: -1, fromType: null };

// --- INIT ---
window.onload = () => {
    resize();
    // –†–∏—Å—É–µ–º —Ñ–æ–Ω —Å—Ä–∞–∑—É, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —á–µ—Ä–Ω–æ—Ç—ã
    ctx.fillStyle = '#1565c0'; ctx.fillRect(0,0,cvs.width, cvs.height);
};

function initGame() {
    document.getElementById('start-screen').style.display = 'none';
    document.getElementById('ui-layer').style.display = 'block';
    
    // –°—Ç–∞—Ä—Ç–ø–∞–∫
    if(!player.belt[0]) addItem('rock', 1);
    
    generateWorld();
    gameRunning = true;
    updateUI();
    loop();
}

function generateWorld() {
    world.entities = [];
    world.static = [];
    world.roads = [];

    // –î–æ—Ä–æ–≥–∞
    let rx = 1500;
    for(let y=0; y<H_MAP; y+=20) {
        rx += Math.sin(y*0.005)*5 + (Math.random()-0.5)*2;
        if(rx < 600) rx = 600; if(rx > W_MAP-600) rx = W_MAP-600;
        world.roads.push({x:rx, y:y});
    }

    // –†–µ—Å—É—Ä—Å—ã
    for(let i=0; i<400; i++) {
        let x = X_WATER + Math.random()*(W_MAP-X_WATER);
        let y = Math.random()*H_MAP;
        let type = Math.random()>0.7 ? (Math.random()>0.5?'stone':'iron') : 'tree';
        let nearRoad = false;
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Ä–æ–≥–∏
        for(let j=0; j<world.roads.length; j+=20) if(Math.hypot(x-world.roads[j].x, y-world.roads[j].y) < 100) nearRoad=true;
        
        if(!nearRoad) world.entities.push({x, y, type, hp: type=='tree'?30:50, id:Math.random()});
    }

    // –ë–æ—á–∫–∏ –Ω–∞ –¥–æ—Ä–æ–≥–µ
    for(let i=0; i<world.roads.length; i+=15) {
        if(Math.random()<0.2) {
            let p = world.roads[i];
            world.entities.push({x: p.x+(Math.random()-0.5)*40, y: p.y, type:'barrel', hp:10});
        }
    }

    // –ó–¥–∞–Ω–∏—è (–†–¢)
    createBuilding(world.roads[50].x + 300, 1000, "Gas Station");
    createBuilding(world.roads[100].x - 300, 2500, "Supermarket");

    // –ò–≥—Ä–æ–∫ –Ω–∞ –ø–ª—è–∂
    player.x = 600; player.y = 1500;
}

function createBuilding(x, y, name) {
    let w = 400, h = 300;
    world.static.push({x, y, w, h, type:'floor'});
    world.static.push({x, y, w, h:10, type:'wall'}); // top
    world.static.push({x, y:y+h-10, w, h:10, type:'wall'}); // bot
    world.static.push({x, y, w:10, h, type:'wall'}); // left
    world.static.push({x:x+w-10, y, w:10, h, type:'wall'}); // right
    // –õ—É—Ç
    world.entities.push({x:x+w/2, y:y+h/2, type:'crate', hp:20});
}

// --- LOOP ---
function loop() {
    if(!gameRunning) return;
    try {
        gameTime += 0.05;
        update();
        draw();
    } catch(e) {
        console.error("Game Error:", e);
    }
    requestAnimationFrame(loop);
}

function update() {
    // FIX NAN BUG: –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –ø—Ä–æ–≤–∞–ª–∏–ª—Å—è –≤ –ø—É—Å—Ç–æ—Ç—É
    if(isNaN(player.x) || isNaN(player.y)) { player.x = 600; player.y = 1500; }

    let speed = 4;
    let dx = (input.d - input.a) * speed;
    let dy = (input.s - input.w) * speed;
    
    if(dx||dy) {
        player.x += dx; player.y += dy;
        player.x = Math.max(X_WATER+20, Math.min(W_MAP, player.x));
        player.y = Math.max(0, Math.min(H_MAP, player.y));
    }
    player.angle = Math.atan2(input.my - cvs.height/2, input.mx - cvs.width/2);
    
    cam.x = player.x - cvs.width/2;
    cam.y = player.y - cvs.height/2;
}

// --- RENDER ---
function draw() {
    // –û—á–∏—Å—Ç–∫–∞
    ctx.setTransform(1,0,0,1,0,0);
    ctx.fillStyle = '#000'; ctx.fillRect(0,0,cvs.width, cvs.height);
    
    // –ö–∞–º–µ—Ä–∞
    ctx.translate(-cam.x, -cam.y);

    // –í–æ–¥–∞
    ctx.fillStyle = '#1565c0'; 
    ctx.beginPath(); ctx.moveTo(cam.x, cam.y);
    for(let y=cam.y; y<cam.y+cvs.height; y+=50) ctx.lineTo(X_WATER + Math.sin(y*0.01+gameTime)*20, y);
    ctx.lineTo(cam.x, cam.y+cvs.height); ctx.fill();

    // –ó–µ–º–ª—è
    ctx.fillStyle = '#33691e'; ctx.fillRect(X_WATER, 0, W_MAP, H_MAP);

    // –î–æ—Ä–æ–≥–∞
    if(world.roads.length > 0) {
        ctx.strokeStyle = '#555'; ctx.lineWidth = 80; ctx.lineCap = 'round';
        ctx.beginPath(); ctx.moveTo(world.roads[0].x, world.roads[0].y);
        for(let p of world.roads) ctx.lineTo(p.x, p.y);
        ctx.stroke();
    }

    // –ü–æ–ª—ã –∑–¥–∞–Ω–∏–π
    ctx.fillStyle = '#222';
    world.static.forEach(s => { if(s.type=='floor') ctx.fillRect(s.x, s.y, s.w, s.h); });

    // –û–±—ä–µ–∫—Ç—ã
    let renderList = [...world.entities, {type:'player', y:player.y}];
    world.static.forEach(s => { if(s.type=='wall') renderList.push({type:'wall', obj:s, y:s.y+s.h}); });
    
    renderList.sort((a,b) => a.y - b.y);

    renderList.forEach(e => {
        if(e.type=='player') drawPlayer();
        else if(e.type=='wall') { ctx.fillStyle='#444'; ctx.fillRect(e.obj.x, e.obj.y, e.obj.w, e.obj.h); ctx.strokeStyle='#000'; ctx.strokeRect(e.obj.x, e.obj.y, e.obj.w, e.obj.h); }
        else drawEntity(e);
    });
}

function drawEntity(e) {
    if(e.shake) { ctx.save(); ctx.translate(Math.random()*4-2, 0); e.shake--; }
    
    // –¢–µ–Ω—å
    ctx.fillStyle = 'rgba(0,0,0,0.3)'; ctx.beginPath(); ctx.ellipse(e.x, e.y+5, 20, 8, 0, 0, 6.28); ctx.fill();

    if(e.type === 'tree') {
        ctx.fillStyle = '#3e2723'; ctx.fillRect(e.x-10, e.y-10, 20, 30);
        ctx.fillStyle = '#1b5e20';
        ctx.beginPath(); ctx.moveTo(e.x-40, e.y-10); ctx.lineTo(e.x, e.y-80); ctx.lineTo(e.x+40, e.y-10); ctx.fill();
        ctx.beginPath(); ctx.moveTo(e.x-30, e.y-40); ctx.lineTo(e.x, e.y-100); ctx.lineTo(e.x+30, e.y-40); ctx.fill();
    } 
    else if(e.type.includes('stone') || e.type.includes('iron')) {
        ctx.fillStyle = e.type=='iron'?'#5d4037':'#9e9e9e';
        ctx.beginPath(); ctx.arc(e.x, e.y-10, 25, 0, 6.28); ctx.fill();
        ctx.fillStyle = 'rgba(255,255,255,0.1)'; ctx.beginPath(); ctx.arc(e.x-10, e.y-20, 10, 0, 6.28); ctx.fill();
    }
    else if(e.type === 'barrel') {
        ctx.fillStyle = '#1976d2'; ctx.beginPath(); ctx.arc(e.x, e.y-10, 15, 0, 6.28); ctx.fill();
        ctx.strokeStyle='#000'; ctx.lineWidth=2; ctx.stroke();
    }
    else if(e.type === 'crate') {
        ctx.fillStyle = '#795548'; ctx.fillRect(e.x-20, e.y-20, 40, 40);
        ctx.strokeStyle = '#3e2723'; ctx.strokeRect(e.x-20, e.y-20, 40, 40);
    }

    if(e.shake) ctx.restore();
}

function drawPlayer() {
    ctx.save(); ctx.translate(player.x, player.y); ctx.rotate(player.angle);
    // –¢–µ–ª–æ
    ctx.fillStyle = '#ffb74d'; ctx.beginPath(); ctx.arc(0, 0, 15, 0, 6.28); ctx.fill();
    ctx.fillStyle = '#212121'; ctx.beginPath(); ctx.arc(0, 0, 12, 0, 6.28); ctx.fill(); // –ë—Ä–æ–Ω—è
    // –†—É–∫–∏
    ctx.fillStyle = '#ffb74d'; 
    ctx.beginPath(); ctx.arc(15, 15, 6, 0, 6.28); ctx.fill();
    ctx.beginPath(); ctx.arc(15, -15, 6, 0, 6.28); ctx.fill();
    // –ü—Ä–µ–¥–º–µ—Ç
    let item = player.belt[player.beltIdx];
    if(item) {
        ctx.fillStyle = '#999';
        if(item.id=='ak') { ctx.fillStyle='black'; ctx.fillRect(10, -4, 40, 8); }
        else ctx.fillRect(10, -5, 20, 10);
    }
    ctx.restore();
}

// --- INTERACTION & UI ---
window.onmousedown = e => {
    // –î—Ä–∞–≥ (–õ–ö–ú)
    if(e.button === 0) {
        if(e.target.closest('.slot')) {
            let slot = e.target.closest('.slot');
            startDrag(e, slot);
            return;
        }
        if(e.target.closest('.panel') || e.target.closest('#hotbar')) return;
        
        // –ê—Ç–∞–∫–∞
        let hand = player.belt[player.beltIdx];
        let hit = false;
        let wx = cam.x + e.clientX, wy = cam.y + e.clientY;
        
        world.entities.forEach((ent, i) => {
            if(Math.hypot(ent.x-wx, ent.y-wy) < 50 && Math.hypot(player.x-ent.x, player.y-ent.y) < 200) {
                let dmg = (hand && ITEMS[hand.id].dmg) || 5;
                if(hand && ITEMS[hand.id].bonus == ent.type) dmg *= 2;
                ent.hp -= dmg; ent.shake = 10;
                if(ent.hp <= 0) {
                    world.entities.splice(i, 1);
                    if(ent.type=='tree') addItem('wood', 50);
                    if(ent.type=='stone') addItem('stone', 30);
                    if(ent.type=='barrel') { addItem('scrap', 2); addItem('fat', 1); }
                    if(ent.type=='crate') { addItem('scrap', 10); addItem('wood', 50); }
                }
                hit = true;
            }
        });
    }
};

// DRAG SYSTEM (FIXED)
function startDrag(e, slotElem) {
    // –ò–Ω–¥–µ–∫—Å –∏–∑ DOM
    let container = slotElem.parentElement;
    let isBelt = container.id === 'hotbar';
    let idx = Array.from(container.children).indexOf(slotElem);
    let arr = isBelt ? player.belt : player.inv;
    let item = arr[idx];

    if(!item) return;

    dragObj = { active: true, item: item, fromIdx: idx, fromType: isBelt?'belt':'inv' };
    
    let ghost = document.getElementById('drag-ghost');
    ghost.style.display = 'flex';
    ghost.innerHTML = `<div class="slot" style="background:#444"><div class="slot-icon">${ITEMS[item.id].icon}</div></div>`;
    moveGhost(e);
}

window.onmousemove = e => {
    input.mx = e.clientX; input.my = e.clientY;
    if(dragObj.active) moveGhost(e);
};

window.onmouseup = e => {
    if(dragObj.active) {
        let slot = e.target.closest('.slot');
        if(slot) {
            let container = slot.parentElement;
            let isBelt = container.id === 'hotbar';
            let toIdx = Array.from(container.children).indexOf(slot);
            
            let fromArr = dragObj.fromType=='belt' ? player.belt : player.inv;
            let toArr = isBelt ? player.belt : player.inv;
            
            // Swap
            let temp = toArr[toIdx];
            toArr[toIdx] = fromArr[dragObj.fromIdx];
            fromArr[dragObj.fromIdx] = temp;
        }
        dragObj.active = false;
        document.getElementById('drag-ghost').style.display = 'none';
        updateUI();
    }
};

function moveGhost(e) {
    let g = document.getElementById('drag-ghost');
    g.style.left = e.clientX+'px'; g.style.top = e.clientY+'px';
}

// INVENTORY FUNCS
function addItem(id, count) {
    let note = `+${count} ${ITEMS[id].name}`;
    // Stack
    for(let arr of [player.belt, player.inv]) {
        for(let s of arr) if(s && s.id == id) { s.count += count; notify(note); updateUI(); return; }
    }
    // Empty
    for(let i=0; i<6; i++) if(!player.belt[i]) { player.belt[i]={id,count}; notify(note); updateUI(); return; }
    for(let i=0; i<24; i++) if(!player.inv[i]) { player.inv[i]={id,count}; notify(note); updateUI(); return; }
    notify("–†—é–∫–∑–∞–∫ –ø–æ–ª–æ–Ω!");
}

function notify(txt) {
    let d = document.createElement('div'); d.className='note'; d.innerText=txt;
    document.getElementById('notify-area').appendChild(d);
    setTimeout(()=>d.remove(), 3000);
}

function updateUI() {
    renderGrid('hotbar', player.belt, 6);
    renderGrid('inv-grid', player.inv, 24);
    
    let cl = document.getElementById('craft-list'); cl.innerHTML='';
    RECIPES.forEach(r => {
        let row = document.createElement('div');
        row.style.cssText = "display:flex; justify-content:space-between; padding:10px; background:#444; margin-bottom:5px; cursor:pointer; border:1px solid #555";
        let cost = Object.keys(r.cost).map(k=>`${ITEMS[k].icon}${r.cost[k]}`).join(' ');
        row.innerHTML = `<span>${ITEMS[r.id].name}</span><span style="font-size:12px; color:#aaa">${cost}</span>`;
        row.onclick = () => {
            for(let k in r.cost) if(countItem(k)<r.cost[k]) return notify("–ú–∞–ª–æ —Ä–µ—Å—É—Ä—Å–æ–≤");
            for(let k in r.cost) takeItem(k, r.cost[k]);
            addItem(r.id, 1);
        };
        cl.appendChild(row);
    });
}

function renderGrid(id, arr, size) {
    let el = document.getElementById(id); el.innerHTML = '';
    for(let i=0; i<size; i++) {
        let d = document.createElement('div'); d.className='slot';
        if(id=='hotbar' && i==player.beltIdx) d.classList.add('active');
        if(arr[i]) d.innerHTML = `<div class="slot-icon">${ITEMS[arr[i].id].icon}</div><div class="slot-count">${arr[i].count}</div>`;
        el.appendChild(d);
    }
}

function countItem(id) { let c=0; [...player.belt, ...player.inv].forEach(s=>{if(s&&s.id==id)c+=s.count}); return c; }
function takeItem(id, n) {
    let left=n;
    [player.belt, player.inv].forEach(arr=>{
        arr.forEach((s,i)=>{
            if(left>0 && s && s.id==id) { let t=Math.min(left, s.count); s.count-=t; left-=t; if(s.count<=0) arr[i]=null; }
        });
    });
    updateUI();
}

// EVENTS
window.onkeydown = e => {
    if(e.code=='KeyW') input.w=1; if(e.code=='KeyS') input.s=1;
    if(e.code=='KeyA') input.a=1; if(e.code=='KeyD') input.d=1;
    if(e.code=='KeyE') {
        let m = document.getElementById('game-menu');
        m.style.display = m.style.display=='none' ? 'flex' : 'none';
    }
    if(e.key>='1' && e.key<='6') { player.beltIdx = parseInt(e.key)-1; updateUI(); }
};
window.onkeyup = e => { if(e.code=='KeyW') input.w=0; if(e.code=='KeyS') input.s=0; if(e.code=='KeyA') input.a=0; if(e.code=='KeyD') input.d=0; };
function resize() { cvs.width = window.innerWidth; cvs.height = window.innerHeight; }
window.onresize = resize;
</script>
</body>
</html>
