<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –°–ù–°</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #0d1117; color: #c9d1d9; padding: 20px; margin: 0; }
        .box { max-width: 850px; margin: 20px auto; background: #161b22; border: 1px solid #30363d; padding: 25px; border-radius: 12px; }
        h2 { text-align: center; color: #58a6ff; text-transform: uppercase; }
        input, textarea, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 6px; border: 1px solid #30363d; background: #0d1117; color: white; box-sizing: border-box; }
        button { cursor: pointer; font-weight: bold; background: #238636; border: none; }
        button:hover { background: #2ea043; }
        .search-bar { border: 2px solid #58a6ff; font-size: 1.1em; margin-bottom: 20px; }
        .hidden { display: none; }
        .player-card { border: 1px solid #30363d; padding: 15px; margin-top: 15px; display: flex; gap: 20px; background: #21262d; border-radius: 8px; }
        .player-card img { width: 100px; height: 100px; border-radius: 6px; object-fit: cover; border: 2px solid #58a6ff; }
        .card-info { flex: 1; }
        .controls { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; padding-top: 10px; border-top: 1px solid #30363d; }
        .mini-btn { width: 50px; height: 35px; background: #30363d; color: #58a6ff; border: 1px solid #58a6ff; font-size: 12px; }
        .btn-action { background: #8957e5; width: auto; padding: 5px 15px; font-size: 12px; }
        .btn-del { background: #da3633; width: auto; padding: 5px 15px; font-size: 12px; }
        .mode-tag { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; background: #30363d; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="box">
    <h2>–ö–û–î –î–û–°–¢–£–ü–ê</h2>
    
    <div id="login-screen">
        <input type="password" id="p_code" placeholder="–ö–æ–¥ –¥–æ—Å—Ç—É–ø–∞...">
        <button onclick="auth()">–í–û–ô–¢–ò</button>
    </div>

    <div id="main-ui" class="hidden">
        <div id="current-mode" class="mode-tag">–†–µ–∂–∏–º: –ü—Ä–æ—Å–º–æ—Ç—Ä</div>
        <input type="text" class="search-bar" id="search-input" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ ID..." oninput="renderData()">

        <div id="admin-form" class="hidden">
            <input type="text" id="reg-name" placeholder="–ù–∏–∫–Ω–µ–π–º">
            <input type="text" id="reg-id" placeholder="ID –∏–≥—Ä–æ–∫–∞">
            <input type="text" id="reg-term" placeholder="–¢–µ–∫—É—â–∏–π —Å—Ä–æ–∫">
            <label style="font-size: 12px;">–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è:</label>
            <input type="file" id="file-picker" accept="image/*">
            <input type="hidden" id="img-base64">
            <button onclick="createNew()">–°–û–ó–î–ê–¢–¨ –î–ï–õ–û</button>
            <hr style="border-color: #30363d;">
        </div>

        <div id="player-list"></div>
        <button onclick="location.reload()" style="background: #30363d; margin-top: 20px;">–í–´–•–û–î</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "–¢–í–û–ô_API_KEY", 
        databaseURL: "https://dfdf-ba19f-default-rtdb.firebaseio.com/",
        projectId: "dfdf-ba19f",
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    let userRole = 'view';

    document.getElementById('file-picker').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = () => document.getElementById('img-base64').value = reader.result;
        if (e.target.files[0]) reader.readAsDataURL(e.target.files[0]);
    });

    function auth() {
        const code = document.getElementById('p_code').value;
        const tag = document.getElementById('current-mode');
        if (code === '5389') { userRole = 'view'; }
        else if (code === '3956') { userRole = 'judge'; tag.style.color = "#8957e5"; tag.innerText = "–†–ï–ñ–ò–ú: –°–£–î–¨–Ø"; }
        else if (code === '4583') { 
            userRole = 'admin'; 
            tag.style.color = "#f85149"; tag.innerText = "–†–ï–ñ–ò–ú: –ê–î–ú–ò–ù";
            document.getElementById('admin-form').classList.remove('hidden');
        } else { alert("–û–®–ò–ë–ö–ê"); return; }
        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('main-ui').classList.remove('hidden');
        renderData();
    }

    function renderData() {
        const query = document.getElementById('search-input').value.toLowerCase();
        database.ref('players').on('value', (snap) => {
            const list = document.getElementById('player-list');
            list.innerHTML = '';
            const data = snap.val();
            for (let key in data) {
                const p = data[key];
                if (p.id_code.toLowerCase().includes(query)) {
                    let card = `
                        <div class="player-card">
                            <img src="${p.img || 'https://via.placeholder.com/100'}">
                            <div class="card-info">
                                <b>${p.n}</b> [ID: ${p.id_code}]<br>
                                <small>–°—Ä–æ–∫: ${p.t || '‚Äî'}</small><br>
                                –°—É–¥–∏–º–æ—Å—Ç–µ–π: <b>${p.s || 0}</b> | –ö–∞–∑–Ω–µ–π: <b>${p.k || 0}</b> | <b>–û—Ç—Å–∏–¥–µ–ª: ${p.p || 0} —Ä–∞–∑</b>
                                <div style="color: #ffa657; font-size: 13px; margin-top:5px;">–î–µ–ª–æ: ${p.v || '–ß–∏—Å—Ç–æ'}</div>
                    `;
                    if (userRole === 'judge' || userRole === 'admin') {
                        card += `
                            <div class="controls">
                                <button class="mini-btn" onclick="modify('${key}','s',1)">S+</button>
                                <button class="mini-btn" onclick="modify('${key}','k',1)">K+</button>
                                <button class="mini-btn" onclick="modify('${key}','p',1)" title="–î–æ–±–∞–≤–∏—Ç—å –æ—Ç—Å–∏–¥–∫—É">–¢–Æ–†–¨–ú–ê+</button>
                                <button class="mini-btn" onclick="modify('${key}','p',-1)">P-</button>
                                <button class="btn-action" onclick="editV('${key}','${p.v || ''}')">–ò–ó–ú–ï–ù–ò–¢–¨ –ü–†–ï–°–¢–£–ü–õ–ï–ù–ò–Ø</button>
                                ${userRole === 'admin' ? `<button class="btn-del" onclick="removeP('${key}')">–£–î–ê–õ–ò–¢–¨</button>` : ''}
                            </div>
                        `;
                    }
                    card += `</div></div>`;
                    list.innerHTML += card;
                }
            }
        });
    }

    function createNew() {
        const n = document.getElementById('reg-name').value;
        const id = document.getElementById('reg-id').value;
        if(!n || !id) return alert("–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è!");
        database.ref('players').push({
            n: n, id_code: id, t: document.getElementById('reg-term').value,
            img: document.getElementById('img-base64').value,
            s: 0, k: 0, p: 0, v: "–ù–æ–≤–æ–µ –¥–µ–ª–æ"
        });
        alert("–î–æ–±–∞–≤–ª–µ–Ω–æ!");
    }

    function modify(key, field, val) {
        database.ref('players/' + key + '/' + field).transaction(c => (c || 0) + val);
    }

    function editV(key, old) {
        const text = prompt("–û–ø–∏—à–∏—Ç–µ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è:", old);
        if (text !== null) database.ref('players/' + key + '/v').set(text);
    }

    function removeP(key) { if(confirm("–£–¥–∞–ª–∏—Ç—å?")) database.ref('players/' + key).remove(); }
</script>
</body>
</html>
