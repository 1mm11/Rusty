<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ë–ê–ó–ê –î–ê–ù–ù–´–• –°–ù–°</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #0d1117; color: #e6edf3; padding: 20px; margin: 0; }
        .box { max-width: 900px; margin: 20px auto; background: #161b22; border: 1px solid #30363d; padding: 30px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.6); }
        h2 { text-align: center; color: #58a6ff; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 30px; border-bottom: 2px solid #30363d; padding-bottom: 10px; }
        input, textarea, button { width: 100%; padding: 14px; margin: 10px 0; border-radius: 8px; border: 1px solid #30363d; background: #0d1117; color: white; font-size: 16px; box-sizing: border-box; }
        button { cursor: pointer; font-weight: bold; background: #238636; border: none; transition: 0.2s; }
        button:hover { background: #2ea043; transform: translateY(-1px); }
        
        .search-bar { border: 2px solid #58a6ff !important; background: #0d1117; font-size: 18px; }
        .hidden { display: none; }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∞ —á–µ–ª–æ–≤–µ–∫–∞ */
        .player-card { border: 1px solid #30363d; padding: 20px; margin-top: 20px; display: flex; gap: 25px; background: #21262d; border-radius: 10px; align-items: flex-start; }
        .player-card img { width: 120px; height: 120px; border-radius: 8px; object-fit: cover; border: 2px solid #58a6ff; background: #0d1117; }
        .card-info { flex: 1; }
        .card-info b { color: #58a6ff; font-size: 22px; }
        .stats-row { margin: 10px 0; font-size: 16px; color: #c9d1d9; }
        .stats-row span { margin-right: 15px; }
        .crime-box { color: #ffa657; font-size: 15px; margin-top: 10px; padding: 10px; background: rgba(255,166,87,0.1); border-left: 3px solid #ffa657; border-radius: 4px; }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .controls { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; padding-top: 15px; border-top: 1px solid #30363d; }
        .mini-btn { width: auto; min-width: 55px; height: 40px; background: #30363d; color: #58a6ff; border: 1px solid #58a6ff; font-size: 14px; padding: 0 10px; }
        .mini-btn:hover { background: #58a6ff; color: #000; }
        .btn-action { background: #8957e5; width: auto; padding: 8px 20px; font-size: 14px; }
        .btn-del { background: #da3633; width: auto; padding: 8px 20px; font-size: 14px; }
        .mode-tag { display: inline-block; padding: 5px 15px; border-radius: 20px; font-size: 14px; font-weight: bold; background: #30363d; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="box">
    <h2>–ë–ê–ó–ê –î–ê–ù–ù–´–• –°–ù–°</h2>
    
    <div id="login-screen">
        <input type="password" id="p_code" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞...">
        <button onclick="auth()">–ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø</button>
    </div>

    <div id="main-ui" class="hidden">
        <div id="current-mode" class="mode-tag">–†–µ–∂–∏–º: –ü—Ä–æ—Å–º–æ—Ç—Ä</div>
        <input type="text" class="search-bar" id="search-input" placeholder="üîç –ù–∞–π—Ç–∏ —á–µ–ª–æ–≤–µ–∫–∞ –ø–æ ID..." oninput="renderData()">

        <div id="admin-form" class="hidden">
            <h3 style="color: #3fb950; margin-top: 0;">–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ì–†–ê–ñ–î–ê–ù–ò–ù–ê</h3>
            <input type="text" id="reg-name" placeholder="–ù–∏–∫–Ω–µ–π–º/–ò–º—è">
            <input type="text" id="reg-id" placeholder="ID –∏–≥—Ä–æ–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 777)">
            <input type="text" id="reg-term" placeholder="–¢–µ–∫—É—â–∏–π —Å—Ä–æ–∫ (–µ—Å–ª–∏ –µ—Å—Ç—å)">
            <label style="font-size: 14px; display: block; margin-top: 10px;">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è:</label>
            <input type="file" id="file-picker" accept="image/*">
            <input type="hidden" id="img-base64">
            <button onclick="createNew()">–ó–ê–ù–ï–°–¢–ò –í –ë–ê–ó–£</button>
            <hr style="border: 0; border-top: 1px solid #30363d; margin: 25px 0;">
        </div>

        <div id="player-list"></div>
        <button onclick="location.reload()" style="background: #30363d; margin-top: 30px;">–í–´–•–û–î –ò–ó –°–ò–°–¢–ï–ú–´</button>
    </div>
</div>

<script>
    // –ö–û–ù–§–ò–ì (–í–°–¢–ê–í–¨ –°–í–û–ô –ö–õ–Æ–ß)
    const firebaseConfig = {
        apiKey: "–¢–í–û–ô_–ö–õ–Æ–ß", 
        databaseURL: "https://dfdf-ba19f-default-rtdb.firebaseio.com/",
        projectId: "dfdf-ba19f",
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    let userRole = 'view';

    document.getElementById('file-picker').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = () => document.getElementById('img-base64').value = reader.result;
        if (e.target.files[0]) reader.readAsDataURL(e.target.files[0]);
    });

    function auth() {
        const code = document.getElementById('p_code').value;
        const tag = document.getElementById('current-mode');
        if (code === '5389') { userRole = 'view'; tag.innerText = "–†–ï–ñ–ò–ú: –ü–†–û–°–ú–û–¢–†"; }
        else if (code === '3956') { userRole = 'judge'; tag.style.color = "#a371f7"; tag.innerText = "–†–ï–ñ–ò–ú: –ò–ó–ú–ï–ù–ï–ù–ò–ï –î–ê–ù–ù–´–•"; }
        else if (code === '4583') { 
            userRole = 'admin'; 
            tag.style.color = "#f85149"; tag.innerText = "–†–ï–ñ–ò–ú: –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†";
            document.getElementById('admin-form').classList.remove('hidden');
        } else { alert("–ù–ï–í–ï–†–ù–´–ô –ö–û–î"); return; }
        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('main-ui').classList.remove('hidden');
        renderData();
    }

    function renderData() {
        const query = document.getElementById('search-input').value.toLowerCase();
        database.ref('players').on('value', (snap) => {
            const list = document.getElementById('player-list');
            list.innerHTML = '';
            const data = snap.val();
            for (let key in data) {
                const p = data[key];
                if (p.id_code && p.id_code.toLowerCase().includes(query)) {
                    let card = `
                        <div class="player-card">
                            <img src="${p.img || 'https://via.placeholder.com/120'}">
                            <div class="card-info">
                                <b>${p.n}</b> <span style="color:#8b949e; font-size:16px;">[ID: ${p.id_code}]</span><br>
                                <div class="stats-row">
                                    <span>–°—Ä–æ–∫: <strong>${p.t || '‚Äî'}</strong></span>
                                </div>
                                <div class="stats-row">
                                    <span>–°—É–¥–∏–º–æ—Å—Ç–µ–π: <strong>${p.s || 0}</strong></span>
                                    <span>–ö–∞–∑–Ω–µ–π: <strong>${p.k || 0}</strong></span>
                                    <span>–û—Ç—Å–∏–¥–µ–ª: <strong>${p.p || 0} —Ä–∞–∑</strong></span>
                                </div>
                                <div class="crime-box"><strong>–î–µ–ª–æ:</strong> ${p.v || '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}</div>
                    `;
                    if (userRole === 'judge' || userRole === 'admin') {
                        card += `
                            <div class="controls">
                                <button class="mini-btn" onclick="modify('${key}','s',1)">S+</button>
                                <button class="mini-btn" onclick="modify('${key}','s',-1)">S-</button>
                                <button class="mini-btn" onclick="modify('${key}','k',1)">K+</button>
                                <button class="mini-btn" onclick="modify('${key}','k',-1)">K-</button>
                                <button class="mini-btn" onclick="modify('${key}','p',1)">–¢–Æ–†–¨–ú–ê+</button>
                                <button class="mini-btn" onclick="modify('${key}','p',-1)">P-</button>
                                <button class="btn-action" onclick="editV('${key}','${p.v || ''}')">–ò–ó–ú–ï–ù–ò–¢–¨ –î–ï–õ–û</button>
                                ${userRole === 'admin' ? `<button class="btn-del" onclick="removeP('${key}')">–£–î–ê–õ–ò–¢–¨</button>` : ''}
                            </div>
                        `;
                    }
                    card += `</div></div>`;
                    list.innerHTML += card;
                }
            }
        });
    }

    function createNew() {
        const n = document.getElementById('reg-name').value;
        const id = document.getElementById('reg-id').value;
        if(!n || !id) return alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ ID!");
        database.ref('players').push({
            n: n, id_code: id, t: document.getElementById('reg-term').value,
            img: document.getElementById('img-base64').value,
            s: 0, k: 0, p: 0, v: "–ù–æ–≤–æ–µ –¥–µ–ª–æ"
        });
        alert("–ì—Ä–∞–∂–¥–∞–Ω–∏–Ω –∑–∞–Ω–µ—Å–µ–Ω –≤ –±–∞–∑—É!");
        document.getElementById('reg-name').value = '';
        document.getElementById('reg-id').value = '';
    }

    function modify(key, field, val) {
        database.ref('players/' + key + '/' + field).transaction(c => {
            let newVal = (c || 0) + val;
            return newVal < 0 ? 0 : newVal; // –ù–µ –¥–∞–µ—Ç —É–π—Ç–∏ –Ω–∏–∂–µ –Ω—É–ª—è
        });
    }

    function editV(key, old) {
        const text = prompt("–û–ø–∏—à–∏—Ç–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è/–ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è:", old);
        if (text !== null) database.ref('players/' + key + '/v').set(text);
    }

    function removeP(key) { if(confirm("–£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –≥—Ä–∞–∂–¥–∞–Ω–∏–Ω–∞?")) database.ref('players/' + key).remove(); }
</script>
</body>
</html>
