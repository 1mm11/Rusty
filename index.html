<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–ê–ó–ê –î–ê–ù–ù–´–• –°–ù–°</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root {
            --bg-color: #0d1117;
            --card-bg: #161b22;
            --item-bg: #21262d;
            --accent: #58a6ff;
            --success: #238636;
            --danger: #da3633;
            --warning: #ffa657;
            --text: #e6edf3;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text); 
            padding: 10px; 
            margin: 0; 
        }

        .box { 
            max-width: 900px; 
            margin: 10px auto; 
            background: var(--card-bg); 
            border: 1px solid #30363d; 
            padding: 15px; 
            border-radius: 12px; 
        }

        h2 { text-align: center; color: var(--accent); text-transform: uppercase; font-size: 1.5rem; }

        input, textarea, button { 
            width: 100%; 
            padding: 12px; 
            margin: 5px 0; 
            border-radius: 8px; 
            border: 1px solid #30363d; 
            background: var(--bg-color); 
            color: white; 
            font-size: 16px; 
            box-sizing: border-box; 
        }

        button { cursor: pointer; font-weight: bold; background: var(--success); border: none; }
        button:active { transform: scale(0.98); }

        .search-bar { border: 2px solid var(--accent) !important; position: sticky; top: 10px; z-index: 100; }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ */
        .player-card { 
            border: 1px solid #30363d; 
            padding: 15px; 
            margin-top: 15px; 
            display: flex; 
            flex-direction: row; 
            gap: 15px; 
            background: var(--item-bg); 
            border-radius: 10px; 
        }

        .player-card img { 
            width: 100px; height: 100px; 
            border-radius: 8px; 
            object-fit: cover; 
            border: 2px solid var(--accent); 
        }

        .card-info { flex: 1; min-width: 0; }
        .card-info b { color: var(--accent); font-size: 1.3rem; display: block; overflow-wrap: break-word; }
        
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); 
            gap: 5px; 
            margin: 10px 0; 
            font-size: 14px; 
        }

        .crime-box { 
            color: var(--warning); 
            font-size: 14px; 
            padding: 8px; 
            background: rgba(255,166,87,0.1); 
            border-left: 3px solid var(--warning); 
            border-radius: 4px;
            word-wrap: break-word;
        }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ */
        .controls { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 8px; 
            margin-top: 15px; 
            padding-top: 10px; 
            border-top: 1px solid #30363d; 
        }

        .mini-btn { padding: 10px 5px; background: #30363d; color: var(--accent); border: 1px solid var(--accent); font-size: 12px; width: 100%; }
        .btn-full { grid-column: span 3; font-size: 14px; padding: 10px; }
        .btn-edit { background: #8957e5; }
        .btn-del { background: var(--danger); }

        .hidden { display: none; }

        /* –ú–û–ë–ò–õ–¨–ù–ê–Ø –í–ï–†–°–ò–Ø */
        @media (max-width: 600px) {
            .player-card { flex-direction: column; align-items: center; text-align: center; }
            .player-card img { width: 150px; height: 150px; }
            .controls { grid-template-columns: repeat(2, 1fr); }
            .btn-full { grid-column: span 2; }
            h2 { font-size: 1.2rem; }
        }
    </style>
</head>
<body>

<div class="box">
    <h2>–ë–ê–ó–ê –î–ê–ù–ù–´–• –°–ù–°</h2>
    
    <div id="login-screen">
        <input type="password" id="p_code" placeholder="–ö–æ–¥ –¥–æ—Å—Ç—É–ø–∞">
        <button onclick="auth()">–í–•–û–î</button>
    </div>

    <div id="main-ui" class="hidden">
        <input type="text" class="search-bar" id="search-input" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ ID..." oninput="renderData()">

        <div id="admin-form" class="hidden">
            <input type="text" id="reg-name" placeholder="–ù–∏–∫–Ω–µ–π–º">
            <input type="text" id="reg-id" placeholder="ID –∏–≥—Ä–æ–∫–∞">
            <input type="text" id="reg-term" placeholder="–°—Ä–æ–∫">
            <input type="file" id="file-picker" accept="image/*" style="font-size:12px;">
            <input type="hidden" id="img-base64">
            <button onclick="createNew()">–°–û–ó–î–ê–¢–¨ –ö–ê–†–¢–û–ß–ö–£</button>
        </div>

        <div id="player-list"></div>
        <button onclick="location.reload()" style="background: #30363d; margin-top: 20px;">–í–´–•–û–î</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "–¢–í–û–ô_–ö–õ–Æ–ß", 
        databaseURL: "https://dfdf-ba19f-default-rtdb.firebaseio.com/",
        projectId: "dfdf-ba19f",
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    let userRole = 'view';

    document.getElementById('file-picker').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = () => document.getElementById('img-base64').value = reader.result;
        if (e.target.files[0]) reader.readAsDataURL(e.target.files[0]);
    });

    function auth() {
        const code = document.getElementById('p_code').value;
        if (code === '5389') { userRole = 'view'; }
        else if (code === '3956') { userRole = 'judge'; }
        else if (code === '4583') { 
            userRole = 'admin'; 
            document.getElementById('admin-form').classList.remove('hidden');
        } else { alert("–û–®–ò–ë–ö–ê"); return; }
        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('main-ui').classList.remove('hidden');
        renderData();
    }

    function renderData() {
        const query = document.getElementById('search-input').value.toLowerCase();
        database.ref('players').on('value', (snap) => {
            const list = document.getElementById('player-list');
            list.innerHTML = '';
            const data = snap.val();
            for (let key in data) {
                const p = data[key];
                if (p.id_code && p.id_code.toLowerCase().includes(query)) {
                    let card = `
                        <div class="player-card">
                            <img src="${p.img || 'https://via.placeholder.com/120'}">
                            <div class="card-info">
                                <b>${p.n}</b> [ID: ${p.id_code}]
                                <div class="stats-grid">
                                    <div>–°—Ä–æ–∫: <b>${p.t || '‚Äî'}</b></div>
                                    <div>–°—É–¥–∏–º–æ—Å—Ç–µ–π: <b>${p.s || 0}</b></div>
                                    <div>–ö–∞–∑–Ω–µ–π: <b>${p.k || 0}</b></div>
                                    <div>–¢—é—Ä—å–º–∞: <b>${p.p || 0}</b></div>
                                </div>
                                <div class="crime-box">${p.v || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</div>
                    `;
                    if (userRole === 'judge' || userRole === 'admin') {
                        card += `
                            <div class="controls">
                                <button class="mini-btn" onclick="modify('${key}','s',1)">S+</button>
                                <button class="mini-btn" onclick="modify('${key}','s',-1)">S-</button>
                                <button class="mini-btn" onclick="modify('${key}','k',1)">K+</button>
                                <button class="mini-btn" onclick="modify('${key}','k',-1)">K-</button>
                                <button class="mini-btn" onclick="modify('${key}','p',1)">P+</button>
                                <button class="mini-btn" onclick="modify('${key}','p',-1)">P-</button>
                                <button class="btn-full btn-edit" onclick="editV('${key}','${p.v || ''}')">–ò–ó–ú–ï–ù–ò–¢–¨ –î–ï–õ–û</button>
                                ${userRole === 'admin' ? `<button class="btn-full btn-del" onclick="removeP('${key}')">–£–î–ê–õ–ò–¢–¨</button>` : ''}
                            </div>
                        `;
                    }
                    card += `</div></div>`;
                    list.innerHTML += card;
                }
            }
        });
    }

    function createNew() {
        const n = document.getElementById('reg-name').value;
        const id = document.getElementById('reg-id').value;
        if(!n || !id) return alert("–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è!");
        database.ref('players').push({
            n: n, id_code: id, t: document.getElementById('reg-term').value,
            img: document.getElementById('img-base64').value,
            s: 0, k: 0, p: 0, v: "–ù–æ–≤–æ–µ –¥–µ–ª–æ"
        });
        alert("–û–ö");
    }

    function modify(key, field, val) {
        database.ref('players/' + key + '/' + field).transaction(c => {
            let n = (c || 0) + val; return n < 0 ? 0 : n;
        });
    }

    function editV(key, old) {
        const text = prompt("–î–µ–ª–æ:", old);
        if (text !== null) database.ref('players/' + key + '/v').set(text);
    }

    function removeP(key) { if(confirm("–£–¥–∞–ª–∏—Ç—å?")) database.ref('players/' + key).remove(); }
</script>
</body>
</html>
