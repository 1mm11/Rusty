<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–ê–ó–ê –î–ê–ù–ù–´–• –°–ù–°</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root {
            --bg: #0d1117; --card: #161b22; --item: #21262d;
            --accent: #58a6ff; --success: #238636; --danger: #da3633;
            --warning: #ffa657; --text: #e6edf3;
        }

        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); padding: 10px; margin: 0; }
        .box { max-width: 900px; margin: 10px auto; background: var(--card); border: 1px solid #30363d; padding: 20px; border-radius: 12px; }
        
        h2 { text-align: center; color: var(--accent); text-transform: uppercase; margin-top: 0; border-bottom: 1px solid #30363d; padding-bottom: 10px; }
        
        input, textarea, button { 
            width: 100%; padding: 12px; margin: 6px 0; border-radius: 8px; border: 1px solid #30363d; 
            background: var(--bg); color: white; font-size: 16px; box-sizing: border-box; 
        }

        button { cursor: pointer; font-weight: bold; background: var(--success); border: none; }
        button:hover { opacity: 0.9; }

        .search-bar { border: 2px solid var(--accent) !important; position: sticky; top: 5px; z-index: 100; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }

        .player-card { 
            border: 1px solid #30363d; padding: 15px; margin-top: 15px; display: flex; 
            gap: 20px; background: var(--item); border-radius: 10px; 
        }

        .player-card img { width: 110px; height: 110px; border-radius: 8px; object-fit: cover; border: 2px solid var(--accent); }

        .card-info { flex: 1; min-width: 0; }
        .card-info b { color: var(--accent); font-size: 1.4rem; }
        .address-tag { color: #79c0ff; font-style: italic; font-size: 0.95rem; margin-bottom: 8px; display: block; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; margin: 10px 0; font-size: 15px; }
        .stats-grid div { background: rgba(255,255,255,0.05); padding: 5px 10px; border-radius: 4px; }

        .crime-box { 
            color: var(--warning); font-size: 14px; padding: 10px; 
            background: rgba(255,166,87,0.08); border-left: 3px solid var(--warning); border-radius: 4px; 
        }

        .controls { 
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; 
            margin-top: 15px; padding-top: 12px; border-top: 1px solid #30363d; 
        }

        .mini-btn { padding: 8px 2px; background: #30363d; color: var(--accent); border: 1px solid var(--accent); font-size: 12px; }
        .btn-full { grid-column: span 2; font-size: 13px; padding: 10px; }
        .btn-edit { background: #8957e5; }
        .btn-del { background: var(--danger); }

        .hidden { display: none; }

        @media (max-width: 650px) {
            .player-card { flex-direction: column; align-items: center; text-align: center; }
            .player-card img { width: 140px; height: 140px; }
            .controls { grid-template-columns: repeat(2, 1fr); }
            .btn-full { grid-column: span 2; }
        }
    </style>
</head>
<body>

<div class="box">
    <h2>–ë–ê–ó–ê –î–ê–ù–ù–´–• –°–ù–°</h2>
    
    <div id="login-screen">
        <input type="password" id="p_code" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞">
        <button onclick="auth()">–í–û–ô–¢–ò –í –°–ò–°–¢–ï–ú–£</button>
    </div>

    <div id="main-ui" class="hidden">
        <input type="text" class="search-bar" id="search-input" placeholder="üîç –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ ID..." oninput="renderData()">

        <div id="admin-form" class="hidden">
            <h4 style="margin: 10px 0; color: var(--success);">+ –ù–û–í–ê–Ø –ö–ê–†–¢–û–ß–ö–ê</h4>
            <input type="text" id="reg-name" placeholder="–ù–∏–∫–Ω–µ–π–º">
            <input type="text" id="reg-id" placeholder="ID (–Ω–∞–ø—Ä–∏–º–µ—Ä: 001)">
            <input type="text" id="reg-address" placeholder="–ú–µ—Å—Ç–æ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è (–∞–¥—Ä–µ—Å)">
            <input type="text" id="reg-term" placeholder="–¢–µ–∫—É—â–∏–π —Å—Ä–æ–∫">
            <input type="file" id="file-picker" accept="image/*" style="font-size:12px; border:none;">
            <input type="hidden" id="img-base64">
            <button onclick="createNew()">–°–û–•–†–ê–ù–ò–¢–¨ –í –ë–ê–ó–£</button>
            <hr style="border:0; border-top:1px solid #30363d; margin: 20px 0;">
        </div>

        <div id="player-list"></div>
        <button onclick="location.reload()" style="background: #30363d; margin-top: 30px;">–ó–ê–í–ï–†–®–ò–¢–¨ –°–ï–ê–ù–°</button>
    </div>
</div>

<script>
    // --- –¢–í–û–ò –ù–ê–°–¢–†–û–ô–ö–ò ---
    const firebaseConfig = {
        apiKey: "–¢–í–û–ô_API_KEY", 
        databaseURL: "https://dfdf-ba19f-default-rtdb.firebaseio.com/",
        projectId: "dfdf-ba19f",
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    let userRole = 'view';

    document.getElementById('file-picker').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = () => document.getElementById('img-base64').value = reader.result;
        if (e.target.files[0]) reader.readAsDataURL(e.target.files[0]);
    });

    function auth() {
        const code = document.getElementById('p_code').value;
        if (code === '5389') userRole = 'view';
        else if (code === '3956') userRole = 'judge';
        else if (code === '4583') { 
            userRole = 'admin'; 
            document.getElementById('admin-form').classList.remove('hidden');
        } else { alert("–î–û–°–¢–£–ü –ó–ê–ü–†–ï–©–ï–ù"); return; }
        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('main-ui').classList.remove('hidden');
        renderData();
    }

    function renderData() {
        const query = document.getElementById('search-input').value.toLowerCase();
        database.ref('players').on('value', (snap) => {
            const list = document.getElementById('player-list');
            list.innerHTML = '';
            const data = snap.val();
            for (let key in data) {
                const p = data[key];
                if (p.id_code && p.id_code.toLowerCase().includes(query)) {
                    let card = `
                        <div class="player-card">
                            <img src="${p.img || 'https://via.placeholder.com/120'}">
                            <div class="card-info">
                                <b>${p.n}</b> [ID: ${p.id_code}]
                                <span class="address-tag">üìç –ü—Ä–æ–∂–∏–≤–∞–Ω–∏–µ: ${p.addr || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</span>
                                <div class="stats-grid">
                                    <div>–°—Ä–æ–∫: <b>${p.t || '‚Äî'}</b></div>
                                    <div>–°—É–¥–∏–º–æ—Å—Ç–∏: <b>${p.s || 0}</b></div>
                                    <div>–ö–∞–∑–Ω–∏: <b>${p.k || 0}</b></div>
                                    <div>–¢—é—Ä—å–º–∞: <b>${p.p || 0} —Ä–∞–∑</b></div>
                                </div>
                                <div class="crime-box"><b>–î–µ–ª–æ:</b> ${p.v || '–ù–µ—Ç –Ω–∞—Ä—É—à–µ–Ω–∏–π'}</div>
                    `;
                    if (userRole === 'judge' || userRole === 'admin') {
                        card += `
                            <div class="controls">
                                <button class="mini-btn" onclick="modify('${key}','s',1)">S+</button>
                                <button class="mini-btn" onclick="modify('${key}','s',-1)">S-</button>
                                <button class="mini-btn" onclick="modify('${key}','k',1)">K+</button>
                                <button class="mini-btn" onclick="modify('${key}','k',-1)">K-</button>
                                <button class="mini-btn" onclick="modify('${key}','p',1)">P+</button>
                                <button class="mini-btn" onclick="modify('${key}','p',-1)">P-</button>
                                <button class="mini-btn" style="grid-column: span 2;" onclick="editField('${key}','addr','–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –∞–¥—Ä–µ—Å:')">üè† –ê–î–†–ï–°</button>
                                <button class="btn-full btn-edit" onclick="editField('${key}','v','–û–±–Ω–æ–≤–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–π:')">–ò–ó–ú–ï–ù–ò–¢–¨ –î–ï–õ–û</button>
                                ${userRole === 'admin' ? `<button class="btn-full btn-del" onclick="removeP('${key}')">–£–î–ê–õ–ò–¢–¨</button>` : ''}
                            </div>
                        `;
                    }
                    card += `</div></div>`;
                    list.innerHTML += card;
                }
            }
        });
    }

    function createNew() {
        const n = document.getElementById('reg-name').value;
        const id = document.getElementById('reg-id').value;
        if(!n || !id) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∏–∫ –∏ ID!");
        database.ref('players').push({
            n: n, id_code: id, addr: document.getElementById('reg-address').value,
            t: document.getElementById('reg-term').value,
            img: document.getElementById('img-base64').value,
            s: 0, k: 0, p: 0, v: "–ß–∏—Å—Ç"
        });
        alert("–ì—Ä–∞–∂–¥–∞–Ω–∏–Ω —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!");
    }

    function modify(key, field, val) {
        database.ref('players/' + key + '/' + field).transaction(c => {
            let n = (c || 0) + val; return n < 0 ? 0 : n;
        });
    }

    function editField(key, field, msg) {
        const text = prompt(msg);
        if (text !== null) database.ref('players/' + key + '/' + field).set(text);
    }

    function removeP(key) { if(confirm("–£–¥–∞–ª–∏—Ç—å –≥—Ä–∞–∂–¥–∞–Ω–∏–Ω–∞ –∏–∑ –±–∞–∑—ã –°–ù–°?")) database.ref('players/' + key).remove(); }
</script>
</body>
</html>
